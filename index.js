#!/usr/bin/env node
var svg2png = require('svg2png');

var fs = require('fs');
var d3 = require('d3');
//var xmldom = require('xmldom');
var jsdom = require('jsdom');

jsdom.env(
  "<html><body></body></html>",        // CREATE DOM HOOK
  [ 'http://d3js.org/d3.v3.min.js',    // JS DEPENDENCIES online ...
  'node_modules/d3/d3.js' ],           // ... & offline

  function (err, window) {

    var dataset = {
      apples: [53245, 28479, 19697, 24037, 40245],
    };
     
    var width = 460,
        height = 300,
        radius = Math.min(width, height) / 2;
     
    var color = d3.scale.category20();
     
    var pie = d3.layout.pie()
        .sort(null);
     
    var arc = d3.svg.arc()
        .innerRadius(radius - 100)
        .outerRadius(radius - 50);

    /*
        var svg = window.d3.select("body")
            .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewbox", function() { return "0 0 "+width+" "+height; })
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var path = svg.selectAll("path")
        .data(pie(dataset.apples))
      .enter().append("path")
        .attr("fill", function(d, i) { return color(i); })
        .attr("d", arc);
      */




    var svg = window.d3.select("body")
        .append("svg")
        .attr("width", 100)
        .attr("height", 100)
    .attr("viewbox", function() { return "0 0 "+width+" "+height; });

    svg.append("rect")
        .attr("x", 10)
        .attr("y", 10)
        .attr("width", 80)
        .attr("height", 80)
        .style("fill", "orange");
  
    //PRINTING OUT SELECTION
    console.log( window.d3.select("body").html() );

/*
    fs.unlinkSync('source.svg');
    fs.unlinkSync('dest.png');
    fs.appendFileSync('source.svg', '<?xml version="1.0" encoding="UTF-8"?>');
    fs.appendFileSync('source.svg', window.d3.select("body").html());
*/

    //fs.appendFileSync('source.svg','<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="104" height="96" viewBox="0 0 104 96"><svg width="20" height="32" viewBox="-5 -5 20 32" id="facebook" x="0" y="0"><path d="M3.478 1.235C4.312.418 5.5.142 6.623.108 7.81.098 8.993.104 10.18.104c.004 1.284.006 2.57 0 3.854-.77-.002-1.535 0-2.3-.002-.486-.03-.986.346-1.074.842-.012.86-.004 1.72-.004 2.578 1.124.005 2.248 0 3.37.003-.08 1.24-.23 2.48-.407 3.71-.993.01-1.986 0-2.98.006-.008 3.667.006 7.333-.007 11-1.474.006-2.95-.004-4.423.004-.028-3.666.002-7.335-.015-11.002-.72-.008-1.44.006-2.16-.006.005-1.232.003-2.466.003-3.698.72-.007 1.438.003 2.158-.005.023-1.2-.02-2.4.024-3.597.072-.948.424-1.903 1.115-2.56z" fill="#3D599A"/></svg><svg width="42" height="32" viewBox="-5 -5 42 32" id="twitter" x="20" y="32"><path d="M20.03 1.02C20.72.503 21.524.1 22.395 0c-.12.517-.614.786-1.046 1.02.65-.19 1.284-.47 1.97-.518.184-.006.443 0 .51.212.097.262-.17.467-.375.576-.748.383-1.612.44-2.373.792 1.563-.146 3.124.456 4.31 1.448 1.416 1.155 2.353 2.827 2.692 4.605 1.252.333 2.604.092 3.778-.403-.59 1.326-2.093 1.93-3.468 2.05 1.143.426 2.398.5 3.604.372-.958 1.05-2.438 1.46-3.828 1.428-.578 2.343-1.954 4.445-3.74 6.065-3.472 3.117-8.28 4.61-12.93 4.314-4.464-.267-8.86-2.45-11.5-6.072.23.133.424.317.645.466 2.043 1.466 4.763 1.93 7.193 1.277 1.475-.377 2.812-1.194 3.88-2.26-.682.044-1.442-.076-1.938-.587-.31-.292-.437-.772-.25-1.163.225-.495.725-.776 1.2-.997-1.552.22-3.242-.497-3.957-1.918.524-.62 1.36-.817 2.138-.878-.902-.26-1.832-.58-2.52-1.25-.544-.508-.897-1.21-1.004-1.943.64-.118 1.284-.263 1.94-.236-1.49-.768-2.85-2.23-2.73-4 2.824 1.02 5.6 2.186 8.254 3.59.927.507 1.7 1.238 2.457 1.96.734-1.893 1.524-3.793 2.72-5.452.64-.873 1.396-1.685 2.324-2.26-.036.287-.183.536-.32.785z" fill="#4DA7DE"/></svg><svg width="42" height="32" viewBox="-5 -5 42 32" id="twitterHover" x="62" y="64"><path d="M20.03 1.02C20.72.503 21.524.1 22.395 0c-.12.517-.614.786-1.046 1.02.65-.19 1.284-.47 1.97-.518.184-.006.443 0 .51.212.097.262-.17.467-.375.576-.748.383-1.612.44-2.373.792 1.563-.146 3.124.456 4.31 1.448 1.416 1.155 2.353 2.827 2.692 4.605 1.252.333 2.604.092 3.778-.403-.59 1.326-2.093 1.93-3.468 2.05 1.143.426 2.398.5 3.604.372-.958 1.05-2.438 1.46-3.828 1.428-.578 2.343-1.954 4.445-3.74 6.065-3.472 3.117-8.28 4.61-12.93 4.314-4.464-.267-8.86-2.45-11.5-6.072.23.133.424.317.645.466 2.043 1.466 4.763 1.93 7.193 1.277 1.475-.377 2.812-1.194 3.88-2.26-.682.044-1.442-.076-1.938-.587-.31-.292-.437-.772-.25-1.163.225-.495.725-.776 1.2-.997-1.552.22-3.242-.497-3.957-1.918.524-.62 1.36-.817 2.138-.878-.902-.26-1.832-.58-2.52-1.25-.544-.508-.897-1.21-1.004-1.943.64-.118 1.284-.263 1.94-.236-1.49-.768-2.85-2.23-2.73-4 2.824 1.02 5.6 2.186 8.254 3.59.927.507 1.7 1.238 2.457 1.96.734-1.893 1.524-3.793 2.72-5.452.64-.873 1.396-1.685 2.324-2.26-.036.287-.183.536-.32.785z" fill="#186593"/></svg></svg>');


/*
    svg2png("source.svg", "dest.png", function (err) {
        // PNGs for everyone! 
        if (err) console.log(err);
    });*/
  }
);
